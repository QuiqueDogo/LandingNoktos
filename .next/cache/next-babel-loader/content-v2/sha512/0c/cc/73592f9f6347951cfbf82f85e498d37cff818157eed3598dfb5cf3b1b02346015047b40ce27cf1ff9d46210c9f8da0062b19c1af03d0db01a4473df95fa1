{"ast":null,"code":"import _toConsumableArray from \"C:/Users/Quique/Desktop/LandingCustomers/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"C:/Users/Quique/Desktop/LandingCustomers/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { types } from \"../types\";\nimport * as moment from \"moment\";\nimport { compareDates } from \"../../utils/utils\";\nvar initState = {\n  membershipPackage: {\n    id: 2,\n    nombre: \"\",\n    costo_mensual: \"\",\n    costo_anual: \"\",\n    noches_gratis: \"\",\n    numero_tokens: \"\",\n    descuento: \"\",\n    valor_token: \"\",\n    es_activo: \"\",\n    created_at: \"\",\n    updated_at: \"\"\n  },\n  membership: {\n    id: 1,\n    catalogo_membresia: []\n  },\n  membershipBalance: {},\n  membershipOfCompany: {},\n  data: {},\n  previousBalance: {},\n  payWithToken: [],\n  payMarketPlace: [],\n  buyTokens: [],\n  totalMarketPlace: 0,\n  totalBuyTokens: 0,\n  movementsTokens: [],\n  totalUseTokens: 0,\n  totalBuyCentauros: 0,\n  totalUseCentauros: 0,\n  initialBalanceNoktos: 0,\n  initialBalanceCentauros: 0,\n  finalBalanceNoktos: 0,\n  finalBalanceCentauros: 0,\n  totalBuyTokensMoney: 0\n};\nvar get_membership = types.get_membership,\n    get_previous_balance = types.get_previous_balance,\n    get_movements = types.get_movements,\n    get_movements_history = types.get_movements_history;\n\nvar createMovementsFromPayWithTokenItems = function createMovementsFromPayWithTokenItems(payWithTokenItems) {\n  var movements = [];\n\n  var _iterator = _createForOfIteratorHelper(payWithTokenItems),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var pagoToken = _step.value;\n      var movement = {\n        fecha: pagoToken.created_at,\n        estado: pagoToken.reservacion.estado,\n        token_inicial: pagoToken.token_inicial,\n        token_gasto: pagoToken.token_gasto,\n        token_adquirido: pagoToken.token_ajuste > 0 ? \"*\".concat(pagoToken.token_ajuste) : '-',\n        token_fin: pagoToken.token_fin,\n        noches_gratis_inicial: pagoToken.noches_gratis_inicial,\n        noches_gratis_gasto: pagoToken.noches_gratis_gasto,\n        noches_gratis_fin: pagoToken.noches_gratis_fin,\n        noches_gratis_adquirido: pagoToken.noches_gratis_ajuste > 0 ? \"*\".concat(pagoToken.noches_gratis_ajuste) : '-',\n        created_at_original: pagoToken.reservacion.created_at_original,\n        total: '',\n        viajero: pagoToken.viajero,\n        reservante: pagoToken.reservante,\n        centro_costos: pagoToken.centro_costos,\n        descripcion: \"Reservaci\\xF3n en el hotel: \".concat(pagoToken.host !== undefined ? pagoToken.host.nombre : '', \" con n\\xFAmero de reservaci\\xF3n: \").concat(pagoToken.reservacion !== undefined ? pagoToken.reservacion.codigo_reservacion : '')\n      };\n      movements.push(movement);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return movements;\n};\n\nvar createMovementsFromBuyTokensItems = function createMovementsFromBuyTokensItems(buyTokensItems) {\n  var movements = [];\n\n  var _iterator2 = _createForOfIteratorHelper(buyTokensItems),\n      _step2;\n\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var compraToken = _step2.value;\n      var movement = {\n        fecha: compraToken.created_at,\n        token_inicial: compraToken.token_inicial,\n        token_gasto: '',\n        token_adquirido: compraToken.token_adquirido,\n        token_fin: compraToken.token_fin,\n        noches_gratis_inicial: '',\n        noches_gratis_gasto: '',\n        noches_gratis_fin: '',\n        noches_gratis_adquirido: '',\n        total: compraToken.total,\n        descripcion: compraToken.brand !== null && compraToken.last_4 !== null ? \"Adquisici\\xF3n de noktos en la plataforma con la tarjeta \".concat(compraToken.brand, \" terminaci\\xF3n  \").concat(compraToken.last_4, \" \") : \"Adquisici\\xF3n de noktos en la plataforma por medio de transferencia electr\\xF3nica \"\n      };\n      movements.push(movement);\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n\n  return movements;\n};\n\nvar createMovementsFromDevolutionItems = function createMovementsFromDevolutionItems(devolutionItems) {\n  var movements = [];\n\n  var _iterator3 = _createForOfIteratorHelper(devolutionItems),\n      _step3;\n\n  try {\n    for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n      var devolucionTokens = _step3.value;\n      var movement = {\n        fecha: devolucionTokens.updated_at,\n        token_inicial: devolucionTokens.token_inicial,\n        token_gasto: \"\",\n        token_adquirido: devolucionTokens.token_gasto,\n        token_fin: devolucionTokens.token_fin,\n        total: '',\n        descripcion: \"Devoluci\\xF3n de noktos \"\n      };\n      movements.push(movement);\n    }\n  } catch (err) {\n    _iterator3.e(err);\n  } finally {\n    _iterator3.f();\n  }\n\n  return movements;\n};\n\nfunction compareFromDates(a, b) {\n  var dateA = moment(a.fecha).format(\"YYYY-MM-DD\");\n  var dateB = moment(b.fecha).format(\"YYYY-MM-DD\");\n  var comparison = 0;\n\n  if (dateA > dateB) {\n    comparison = 1;\n  } else if (dateA < dateB) {\n    comparison = -1;\n  }\n\n  return comparison;\n}\n\nvar sumTotal = function sumTotal(items) {\n  return items.reduce(function (a, _ref) {\n    var total = _ref.total;\n    return a + parseInt(total);\n  }, 0);\n};\n\nvar sumUseTokens = function sumUseTokens(items) {\n  return items.reduce(function (a, _ref2) {\n    var token_gasto = _ref2.token_gasto;\n    return a + parseInt(token_gasto);\n  }, 0);\n};\n\nvar sumDevolutionTokens = function sumDevolutionTokens(items) {\n  return items.reduce(function (a, _ref3) {\n    var token_ajuste = _ref3.token_ajuste;\n    return a + parseInt(token_ajuste);\n  }, 0);\n};\n\nvar sumBuyTokensMoney = function sumBuyTokensMoney(items) {\n  return items.reduce(function (a, _ref4) {\n    var total = _ref4.total;\n    return a + parseFloat(total);\n  }, 0);\n};\n\nvar sumBuyTokens = function sumBuyTokens(items) {\n  return items.reduce(function (a, _ref5) {\n    var token_adquirido = _ref5.token_adquirido;\n    return a + parseInt(token_adquirido);\n  }, 0);\n};\n\nvar sumBuyCentauros = function sumBuyCentauros(items) {\n  return items.reduce(function (a, _ref6) {\n    var noches_gratis_gasto = _ref6.noches_gratis_gasto;\n    return a + parseInt(noches_gratis_gasto);\n  }, 0);\n};\n\nvar sumUseCentauros = function sumUseCentauros(items) {\n  return items.reduce(function (a, _ref7) {\n    var token_gasto = _ref7.token_gasto;\n    return a + parseInt(token_gasto);\n  }, 0);\n};\n\nexport default (function () {\n  var _mergedArrayOfBuysAnd, _mergedArrayOfBuysAnd2, _mergedArrayOfBuysAnd3, _mergedArrayOfBuysAnd4, _mergedArrayOfBuysAnd5, _mergedArrayOfBuysAnd6, _mergedArrayOfBuysAnd7, _mergedArrayOfBuysAnd8;\n\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var type = action.type,\n      payload = action.payload;\n\n  switch (type) {\n    case types.select_membership:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        membership: payload.membership\n      });\n\n    case types.select_membership_package:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        membershipPackage: payload.membershipPackage\n      });\n\n    case types.set_membership_balance:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        membershipBalance: payload.membershipBalance\n      });\n\n    case types.set_membership_of_company:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        membershipOfCompany: payload.membershipOfCompany\n      });\n\n    case get_membership:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        data: payload.membership\n      });\n\n    case get_previous_balance:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        previousBalance: payload.previousBalance,\n        totalBuyCentauros: payload.payCentauros\n      });\n\n    case get_movements:\n      var mergedArrayOfBuysAndSell = [].concat(_toConsumableArray(payload.payWithToken), _toConsumableArray(payload.buyTokens));\n      var initialBalanceNoktos = (_mergedArrayOfBuysAnd = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd === void 0 ? void 0 : _mergedArrayOfBuysAnd.token_inicial;\n      var initialBalanceCentauros = ((_mergedArrayOfBuysAnd2 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd2 === void 0 ? void 0 : _mergedArrayOfBuysAnd2.noches_gratis_inicial) !== undefined ? (_mergedArrayOfBuysAnd3 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd3 === void 0 ? void 0 : _mergedArrayOfBuysAnd3.noches_gratis_inicial : (_mergedArrayOfBuysAnd4 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd4 === void 0 ? void 0 : _mergedArrayOfBuysAnd4.noches_inicial;\n      var finalBalanceNoktos = (_mergedArrayOfBuysAnd5 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd5 === void 0 ? void 0 : _mergedArrayOfBuysAnd5.token_fin;\n      var finalBalanceCentauros = ((_mergedArrayOfBuysAnd6 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd6 === void 0 ? void 0 : _mergedArrayOfBuysAnd6.noches_gratis_fin) !== undefined ? (_mergedArrayOfBuysAnd7 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd7 === void 0 ? void 0 : _mergedArrayOfBuysAnd7.noches_gratis_fin : (_mergedArrayOfBuysAnd8 = mergedArrayOfBuysAndSell[mergedArrayOfBuysAndSell.length - 1]) === null || _mergedArrayOfBuysAnd8 === void 0 ? void 0 : _mergedArrayOfBuysAnd8.noches_fin;\n      var movements = [].concat(_toConsumableArray(createMovementsFromPayWithTokenItems(payload.payWithToken)), _toConsumableArray(createMovementsFromBuyTokensItems(payload.buyTokens)), _toConsumableArray(createMovementsFromDevolutionItems(payload.devolutions)));\n      movements.sort(compareDates);\n      return _objectSpread(_objectSpread({}, state), {}, {\n        payWithToken: payload.payWithToken,\n        payMarketPlace: payload.payMarketPlace,\n        buyTokens: payload.buyTokens,\n        movementsTokens: movements,\n        totalMarketPlace: sumTotal(payload.payMarketPlace),\n        totalBuyTokens: sumBuyTokens(payload.buyTokens),\n        totalBuyTokensMoney: sumBuyTokensMoney(payload.buyTokens),\n        totalUseTokens: sumUseTokens(payload.payWithToken) - sumDevolutionTokens(payload.payWithToken),\n        totalUseCentauros: sumBuyCentauros(payload.payWithToken),\n        initialBalanceNoktos: initialBalanceNoktos,\n        initialBalanceCentauros: initialBalanceCentauros,\n        finalBalanceNoktos: finalBalanceNoktos,\n        finalBalanceCentauros: finalBalanceCentauros\n      });\n\n    case get_movements_history:\n      var movementsHistory = [].concat(_toConsumableArray(createMovementsFromPayWithTokenItems(payload.payWithToken)), _toConsumableArray(createMovementsFromBuyTokensItems(payload.buyTokens)), _toConsumableArray(createMovementsFromDevolutionItems(payload.devolutions)));\n      movementsHistory.sort(compareDates);\n      return _objectSpread(_objectSpread({}, state), {}, {\n        payWithToken: payload.payWithToken,\n        payMarketPlace: payload.payMarketPlace,\n        buyTokens: payload.buyTokens,\n        totalMarketPlace: sumTotal(payload.payMarketPlace),\n        totalBuyTokens: sumBuyTokens(payload.buyTokens),\n        movementsTokens: movementsHistory,\n        totalUseTokens: sumUseTokens(payload.payWithToken),\n        previousBalance: {\n          token_inicial: payload.prevMembershipBalance.saldo_token,\n          token_final: payload.prevMembershipBalance.saldo_token_inicial !== null ? payload.prevMembershipBalance.saldo_token_inicial : 0,\n          inicialCentauros: payload.prevMembershipBalance.saldo_noches_gratis,\n          finalCentauros: payload.prevMembershipBalance.saldo_noches_gratis_inicial !== null ? payload.prevMembershipBalance.saldo_noches_gratis_inicial : 0\n        },\n        membershipBalance: _objectSpread(_objectSpread({}, initState.membershipBalance), {}, {\n          saldo_token: payload.prevMembershipBalance.saldo_token\n        }),\n        totalUseCentauros: sumBuyCentauros(payload.payWithToken)\n      });\n\n    default:\n      return state;\n  }\n});","map":null,"metadata":{},"sourceType":"module"}